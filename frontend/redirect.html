<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>í˜ì´ì§€ ì—¬ëŠ” ì¤‘...</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding-top: 60px; }
    button {
      padding: 10px 18px;
      font-size: 15px;
      margin-top: 20px;
      border: 1px solid #ccc;
      background: #f4f4f4;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>ì •ì±… í˜ì´ì§€ë¥¼ ì—¬ëŠ” ì¤‘ì…ë‹ˆë‹¤...</h2>
  <p>ì²˜ìŒ ì—´ë¦¬ì§€ ì•Šìœ¼ë©´ ìë™ìœ¼ë¡œ ë‹¤ì‹œ ì—´ì–´ë“œë¦´ê²Œìš”.<br>ë¬¸ì œê°€ ê³„ì†ë˜ë©´ ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>
  <button id="retry">ğŸ” ë‹¤ì‹œ ì—´ê¸°</button>

  <script>
    const target = new URLSearchParams(location.search).get('target');
    sessionStorage.setItem('lastTarget', target);

    function openWindow() {
      if (target) window.open(target, '_blank');
    }

    async function verifyAndRetryIfNeeded() {
      openWindow();  // 1ì°¨ ì‹œë„

      try {
        const response = await fetch(target, {
          method: 'GET',
          redirect: 'follow',
          mode: 'cors'
        });
        const finalUrl = response.url;

        if (finalUrl.includes('/index.do')) {
          // íŠ•ê²¼ìŒ â†’ 1.5ì´ˆ í›„ ë‹¤ì‹œ ì—´ê¸°
          setTimeout(openWindow, 1500);
        }
      } catch (e) {
        // CORS ë•Œë¬¸ì— í™•ì¸ ë¶ˆê°€ â†’ ê·¸ëƒ¥ í•œ ë²ˆ ë” ì—´ì
        setTimeout(openWindow, 1500);
      }
    }

    // ì‹œì‘
    verifyAndRetryIfNeeded();

    // ìˆ˜ë™ ì¬ì‹œë„ ë²„íŠ¼
    document.getElementById('retry').addEventListener('click', openWindow);
  </script>
</body>
</html>
